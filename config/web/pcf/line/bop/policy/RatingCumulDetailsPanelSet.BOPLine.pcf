<?xml version="1.0"?>
<PCF
  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
  xsi:noNamespaceSchemaLocation="../../../../../../../pcf.xsd">
  <PanelSet
    id="RatingCumulDetailsPanelSet"
    mode="BOPLine">
    <Require
      name="period"
      type="PolicyPeriod"/>
    <Require
      name="jobWizardHelper"
      type="web.job.JobWizardHelper"/>
    <Require
      name="isEditable"
      type="boolean"/>
    <Variable
      initialValue="period.BOPLine.Costs.cast(BOPCost).toSet().byCoveragePremium()"
      name="coverageOrOtherPremiumMap"
      recalculateOnRefresh="true"/>
    <Variable
      initialValue="coverageOrOtherPremiumMap.get(true).byFixedLocation()"
      name="locationCoveragePremiumMap"
      recalculateOnRefresh="true"/>
    <PanelRef
      def="RatingOverrideButtonDV(period, period.BOPLine, jobWizardHelper, CurrentLocation.InEditMode)"
      id="RatingOverrideButtonDV"/>
    <PanelRow>
      <PanelColumn>
        <DetailViewPanel>
          <Variable
            initialValue="locationCoveragePremiumMap.get(null)"
            name="lineLevelCoveragePremiums"
            recalculateOnRefresh="true"/>
          <InputColumn>
            <ListViewInput
              boldLabel="true"
              def="BOPCoverageCostLV(lineLevelCoveragePremiums)"
              label="displaykey.Web.Policy.BOP.Quote.Coverages.Line.Title"
              labelAbove="true">
              <Toolbar/>
            </ListViewInput>
          </InputColumn>
        </DetailViewPanel>
        <PanelIterator
          elementName="location"
          id="locationIterator"
          value="locationCoveragePremiumMap.Keys.where(\ l -&gt; l &lt;&gt; null).toTypedArray()">
          <Variable
            initialValue="locationCoveragePremiumMap.get(location).byFixedBuilding()"
            name="buildingCoveragePremiumMap"
            recalculateOnRefresh="true"/>
          <IteratorSort
            sortBy="location.FixedId"
            sortOrder="1"/>
          <DetailViewPanel>
            <InputColumn>
              <ListViewInput
                def="BOPCoverageCostLV(buildingCoveragePremiumMap.get(null))"
                label="location.DisplayName"
                labelAbove="true">
                <Toolbar/>
              </ListViewInput>
            </InputColumn>
          </DetailViewPanel>
          <PanelIterator
            elementName="building"
            id="buildingIterator"
            value="buildingCoveragePremiumMap.Keys.where(\ b -&gt; b &lt;&gt; null).toTypedArray()">
            <IteratorSort
              sortBy="building.FixedId"
              sortOrder="1"/>
            <DetailViewPanel>
              <InputColumn>
                <ContentInput
                  id="BuildingLinkInput">
                  <Link
                    action="BOPBuildingPopup.push(period.BOPLine, location, building, isEditable, false, jobWizardHelper)"
                    id="BuildingLink"
                    label="building.DisplayName"/>
                </ContentInput>
                <ListViewInput
                  def="BOPCoverageCostLV(buildingCoveragePremiumMap.get(building))">
                  <Toolbar/>
                </ListViewInput>
              </InputColumn>
            </DetailViewPanel>
          </PanelIterator>
        </PanelIterator>
        <DetailViewPanel>
          <InputColumn>
            <ListViewInput
              boldLabel="true"
              label="displaykey.Web.Policy.BOP.Quote.OtherPremiums.Title"
              labelAbove="true">
              <Toolbar/>
              <ListViewPanel>
                <RowIterator
                  canPick="false"
                  editable="false"
                  elementName="otherCost"
                  pageSize="0"
                  value="coverageOrOtherPremiumMap.get(false).toTypedArray()">
                  <Variable
                    initialValue="otherCost typeis BOPAddnlInsuredCost ? otherCost.DisplayNameWM : otherCost.DisplayName"
                    name="displayName"
                    type="String"/>
                  <IteratorSort
                    sortBy="(typeof otherCost).AllTypesInHierarchy.size()"
                    sortDirection="descending"
                    sortOrder="1"/>
                  <IteratorSort
                    sortBy="typeof otherCost"
                    sortOrder="2"/>
                  <IteratorSort
                    sortBy="otherCost.EffDate"
                    sortOrder="3"/>
                  <Row>
                    <Cell
                      enableSort="false"
                      footerLabel="displaykey.Web.Policy.BA.Subtotal"
                      id="Description"
                      label="displaykey.Web.Policy.BOP.Quote.OtherPremiums.Description"
                      value="displayName"
                      wrap="true"/>
                    <Cell
                      enableSort="false"
                      id="Jurisdiction"
                      label="displaykey.Web.Policy.BOP.Quote.Jurisdiction"
                      value="otherCost.State"/>
                    <MonetaryAmountCell
                      enableSort="false"
                      footerSumValue="otherCost.ActualAmountBilling"
                      formatType="currency"
                      id="Amount"
                      label="displaykey.Web.Policy.BOP.Quote.Amount"
                      value="otherCost.ActualAmountBilling"/>
                  </Row>
                </RowIterator>
              </ListViewPanel>
            </ListViewInput>
          </InputColumn>
        </DetailViewPanel>
      </PanelColumn>
    </PanelRow>
  </PanelSet>
</PCF>